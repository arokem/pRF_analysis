<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="popeye : A population receptive field estimation tool">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>popeye</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/kdesimone/popeye">View on GitHub</a>

          <h1 id="project_title">popeye</h1>
          <h2 id="project_tagline">A population receptive field estimation tool</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/kdesimone/popeye/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/kdesimone/popeye/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>

<a name="welcome" class="anchor" href="#welcome"><span class="octicon octicon-link"></span></a>What is a population receptive field?</h3>

<p>A population receptive field (pRF) is a quantitative model of the cumulative response of the population of cells contained within a single fMRI voxel.  The pRF model allows us to interpret and predict the responses of a voxel to different stimuli.  Such pRF models can be designed to describe a wide variety of sensory and cognitive processes.</p>

<h3><a name="welcome" class="anchor" href="#welcome"><span class="octicon octicon-link"></span></a>Installation</h3>

<p>Download the popeye source code from the GitHub repository.  Links to the tarball and zip files are at the top of this page for your convenience.  Using popeye requires that you have installed <a href="http://www.numpy.org/">NumPy</a>, <a href="http://www.scipy.org/">SciPy</a>, and <a href="http://www.cython.org/">Cython</a>.  Installing <a href="http://www.matplotlib.org/">matplotlib</a> is recommended as we'll be plotting the results of our pRF estimation but is not required for any of the model fitting procedures in popeye.</p>

<p>Once you've downloaded the popeye source code and installed the aforementioned dependencies, you'll need to install popeye and build the Cython extensions I've written for speeding up the analyses.</p> 

<pre><code><font size="2">
$ cd popeye
$ sudo python setup.py install build_ext
$ python
>>> import popeye
>>> popeye.__version__
'0.1.0.dev'
</font></code></pre><p></p>

<h3><a name="welcome" class="anchor" href="#welcome"><span class="octicon octicon-link"></span></a>Getting started</h3>

<p>Below is a small demonstration of how to interact with the popeye API.  Here, we'll generate our stimulus and simulate the BOLD response of a Gaussian pRF model estimate we'll just invent.  Normally, we'd be analyzing the BOLD time-series that we collect while we present a participant with a visual stimulus.</p>

<pre><code><font size="2">
import popeye.utilities as utils
import popeye.gaussian as gaussian
from popeye.visual_stimulus import VisualStimulus, simulate_bar_stimulus
from popeye.spinach import MakeFastGaussPrediction
from scipy.signal import fftconvolve

# set the screen properties
pixels_across = 800 # pixels
pixels_down = 600 # pixels
viewing_distance = 38 # cm
screen_width = 25 # cm

# set the bar stimulus properties
thetas = np.arange(0,360,45) # degrees
eccentricity- = 10 # degrees
num_steps = 20 # integer

# set the timing and scale properties
tr_length = 1.0 # seconds
frames_per_tr = 1 # integer
scale_factor = 0.05 # scaling factor between 0 and 1

# create the sweeping bar stimulus in memory
bar = simulate_bar_stimulus(pixels_across, pixels_down, viewing_distance,
                            screen_width, thetas, num_steps, eccentricity)

# create an instance of the Stimulus class
stimulus = VisualStimulus(bar, viewing_distance, screen_width, 
                          scale_factor, frames_per_tr)

# set up bounds for the grid search
search_bounds = ((-10,10),(-10,10),(0.25,5.25),(-5,5),(0.1,1e2))
fit_bounds = ((-12,12),(-12,12),(1/stimulus.ppd,12),(-5,5),(0.1,1e2))

# initialize the gaussian model
model = gaussian.GaussianModel(stimulus)

# invent a pRF estimate
x = -5.24 # degrees
y = 2.583 # degrees
sigma = 1.24 # degrees
hrf_delay = -0.25 # seconds relative to canonical HRF (5 sec)
beta = 2.53 # amplitude

# make the stim time-series
stim = MakeFastGaussPrediction(stimulus.deg_x, stimulus.deg_y, 
                               stimulus.stim_arr, 
                               x, y, sigma)

# create the HRF
hrf = utils.double_gamma_hrf(hrf_delay, tr_length, frames_per_tr)

# simulate the BOLD response
data = fftconvolve(stim,hrf)[0:len(stim)] * beta

# fit the response
fit = gaussian.GaussianFit(data, model, search_bounds, fit_bounds, tr_length)

</font></code></pre></br>

<p> Below is the output of the model fit we invoked in the code block above.  Notice that the model fits the data perfectly (the residual sum of squared error is approximately 0).  This may seem somewhat circular in that we've invented a pRF estimate and BOLD time-series only to then fit the "data" to derive the invented pRF estimate we started with in the first place.  However, this approach is useful for writing tests to ensure robustness of the fitting procedures during development and for demonstrating the functionality of popeye.</p>

<img src="images/demo.png">


<h3>
<a name="authors-and-contributors" class="anchor" href="#authors-and-contributors"><span class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>Popeye was created by Kevin DeSimone (<a href="https://github.com/kdesimone" class="user-mention">@kdesimone</a>) with significant contributions and guidance from Ariel Rokem (<a href="https://github.com/arokem" class="user-mention">@arokem</a>).</p>
<h3>

<a name="support-or-contact" class="anchor" href="#support-or-contact"><span class="octicon octicon-link"></span></a>Support or Contact</h3>

<p>Having trouble with popoeye? Contact <a href="mailto:kevindesimone@gmail.com">kevindesimone@gmail.com</a> and I'll help you sort it out.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">popeye maintained by <a href="https://github.com/kdesimone">kdesimone</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
